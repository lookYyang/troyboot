<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head th:include="include :: header">
</head>
<body>
	<div id="content">
		<div class="ibox-content">
			<div class="row row-lg">
				<div class="col-sm-4">
					<h4 class="example-title">树菜单</h4>
					<div class="example">
						<Tree :data="treeData"></Tree>
					</div>
				</div>
				<div class="col-sm-8">
					<div class="ibox">
						<div class="ibox-body table-responsive">
							<div class="fixed-table-toolbar">
								<div class="columns pull-left">
									<button shiro:hasPermission="sys:permission:add" type="button"
											class="btn  btn-primary" v-on:click="add">
										<i class="fa fa-plus hidden" aria-hidden="true"></i>添加
									</button>
									<button shiro:hasPermission="sys:permission:batchRemove" type="button"
											class="btn  btn-danger" v-on:click="batchRemove">
										<i class="fa fa-trash hidden" aria-hidden="true"></i>删除
									</button>
								</div>
							</div>
							<table id="tableId" data-mobile-responsive="true"></table>
						</div>
					</div>
				</div>
			</div>
		</div>

        <Modal ref="modal" v-model="modal" :rules='ruleValidate' :title="formTitle" @on-ok="ok" @on-cancel="cancel" >
            <i-form :model="formItem" :label-width="80">
                <form-item label="名称" prop='required'>
                    <i-input v-model="formItem.name" placeholder="请输入名称..."></i-input>
                </form-item>
                <form-item label="权限" prop='required'>
                    <i-input v-model="formItem.permission" placeholder="请输入权限..."></i-input>
                </form-item>
                <form-item label="路径" prop='required'>
                    <i-input v-model="formItem.url" placeholder="请输入路径..."></i-input>
                </form-item>
                <form-item label="权限类型" prop='group'>
                    <i-select v-model="formItem.type" clearable>
                        <i-option v-for="item in perType" :value="item.value" :key="item.value">{{ item.label }}</i-option>
                    </i-select>
                </form-item>
                <form-item label="排序" prop='required'>
                    <i-input v-model="formItem.sortNo" placeholder="请输入序号..." number></i-input>
                </form-item>
                <form-item label="图标">
                    <i-input v-model="formItem.icon" placeholder="请选择图标..."></i-input>
                </form-item>
                <form-item label="是否启用" prop='required'>
                    <i-switch v-model="formItem.isEnable" @on-change="change" />
                </form-item>
            </i-form>
        </Modal>
	</div>

	<div th:include="include::footer"></div>
	<script th:src="@{/js/component/table.js}"></script>
<script>
    new Vue({
        el: '#content',
        data() {
            return {
                columns: [
                    {field: 'selectItem', checkbox: true},
                    {title: 'id', field: 'id', visible: false},
                    {title: 'parent_id', field: 'parentId', visible: false},
                    {title: '名称', field: 'name', align: 'center', valign: 'middle'},
                    {title: '授权', field: 'permission', align: 'center', valign: 'middle'},
                    {title: '访问路径', field: 'url', align: 'center', valign: 'middle'},
                    {title: '节点类型', field: 'type', align: 'center', valign: 'middle'},
                    {title: '排序号', field: 'sortNo', align: 'center', valign: 'middle', sortable: true},
                    {title: '图标', field: 'icon', align: 'center', valign: 'middle'},
                    {title: '是否启用', field: 'isEnable', align: 'center', valign: 'middle',
                        formatter: function (value, row, index) {
                            return value == 1 ? '<span class="label label-primary">是</span>' : '<span class="label label-primary">否</span>';
                        }},
                    {title: '操作', align: 'center', valign: 'middle',
                        formatter: function (value, row, index) {
                            return "<button type='button' class='btn  btn-primary' onclick='edit(" + JSON.stringify(row) + ")'>修改</button>";
                        }},
                ],
                treeData: '',
                tableUrl: '/sys/permission/list',
                modalTitle: '',
                modal: false,
                formItem: {
                    name: '',
                    permission: '',
                    url: '',
                    type: '2',
                    sortNo: '',
                    icon: '',
                    isEnable: '',
                },
                ruleValidate:{
                    required:[{required: true, type: 'string', message: '', trigger: 'change'}],
                    group:[{required: true, type: 'string', message: '请选择分组', trigger: 'change'}],
                },
                perType:[
                    {
                        value: '0',
                        label: '目录'
                    },
                    {
                        value: '1',
                        label: '菜单'
                    },
                    {
                        value: '2',
                        label: '按钮'
                    },
                ],
                formTitle: '',
                table: '',
            }
        },
        computed:{

		},
		mounted (){
			this.init();
			this.initTable();
		},
        methods: {
			init() {
				this.treeData = [
                    {title: 'parent 1', expand: true,
                        children: [
                            {title: 'parent 1-1', expand: true,
                                children: [{title: 'leaf 1-1-1'}, {title: 'leaf 1-1-2'}]
                            },
                            {title: 'parent 1-2', expand: true,
                                children: [{title: 'leaf 1-2-1'}, {title: 'leaf 1-2-1'}]
                            }
                        ]
                    }
                ];
			},
			initTable(){
                this.table = new BSTable("tableId", this.tableUrl, this.columns);
                this.table.init();
			},
			add(){
			    // TODO
                // 这里需要重置表单
			    this.formTitle = '权限新增';
                this.modal = true;
			},
            batchRemove(){
                var selRow = this.table.tableSelections();
                console.log(selRow);
			},
            edit(row){
                this.formTitle = '权限修改';
			    console.log(row);
            },
            ok() {
                this.$Message.info('Clicked ok');
            },
            cancel() {

            },
            change (status) {
                console.log('开关状态：' + status);
            }
        }
    })
</script>
</body>
</html>